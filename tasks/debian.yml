---
- name: install os packages
  apt:
    name:
      - git
      - curl
      - apt-transport-https
    state: present

- name: install gpg key for nodesource repo
  apt_key:
    url: https://deb.nodesource.com/gpgkey/nodesource.gpg.key
    state: present

- name: add nodesource repository
  apt_repository:
    repo: 'deb https://deb.nodesource.com/{{ nodejs_repo }} {{ ansible_distribution_release }} main'
    state: present

- name: uninstall eventually by os distribution installed nodered version
  apt:
    name:
      - nodered
    state: absent

- name: install nodejs
  apt:
    name:
      - nodejs
    state: present

- name: Check is npm was installed as part of nodejs (does not with raspberryDesktop)
  shell: command -v npm >/dev/null 2>&1
  register: is_npm_exists
  changed_when: false
  ignore_errors: true

- name: install npm
  apt:
    name:
      - npm
    state: present
  when: not is_npm_exists

# - name: Download nodered setup script
#   get_url:
#     url: https://raw.githubusercontent.com/node-red/linux-installers/master/deb/update-nodejs-and-nodered
#     dest: /tmp/
#     mode: 0755
#   register: nodered
